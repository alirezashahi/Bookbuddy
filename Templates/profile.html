{% extends "base.html" %}

{% block title %}Edit Profile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<section class="edit-profile">
    <h1>Edit your profile</h1>
    <div class="profile-picture">
        <img src="{{ url_for('static', filename='images/transparent_avatar.png') }}" alt="Profile Picture">
        <p>Edit picture</p>
    </div>
    <form method="POST" action="{{ url_for('profile') }}">
        {{ form.csrf_token }}
        {% if form.errors %}
            <div class="alert alert-danger">
                Please correct the following errors:
                <ul>
                    {% for field, errors in form.errors.items() %}
                        {% for error in errors %}
                            <li>{{ field }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        <div class="form-group">
            <label for="username">Username</label>
            {{ form.username(class="form-control", id="username") }}
            {% if form.username.errors %}
                {% for error in form.username.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="gender">Gender</label>
            {{ form.gender(class="form-control") }}
            {% if form.gender.errors %}
                {% for error in form.gender.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="bio">Bio</label>
            {{ form.bio(class="form-control", id="bio") }}
            <small class="text-muted">Maximum 500 characters</small>
            <div id="charCount" class="text-muted">0/500</div>
            {% if form.bio.errors %}
                {% for error in form.bio.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="birthday">Birthday</label>
            {{ form.birthday(class="form-control", id="birthday") }}
            {% if form.birthday.errors %}
                {% for error in form.birthday.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="telephone">Telephone</label>
            {{ form.telephone(class="form-control", id="telephone") }}
            {% if form.telephone.errors %}
                {% for error in form.telephone.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="language">Language</label>
            {{ form.language(class="form-control", id="language") }}
            {% if form.language.errors %}
                {% for error in form.language.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>

        <h2>Profile Privacy</h2>
        <div class="form-group">
            <label for="privacy">Account Privacy</label>
            {{ form.privacy(class="form-control", id="privacy") }}
            {% if form.privacy.errors %}
                {% for error in form.privacy.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="friends_list">Close friends list</label>
            {{ form.friends_list(class="form-control", id="friends_list") }}
            {% if form.friends_list.errors %}
                {% for error in form.friends_list.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="block_list">Block list</label>
            {{ form.block_list(class="form-control", id="block_list") }}
            {% if form.block_list.errors %}
                {% for error in form.block_list.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-group">
            <label for="hide_list">Hide list</label>
            {{ form.hide_list(class="form-control", id="hide_list") }}
            {% if form.hide_list.errors %}
                {% for error in form.hide_list.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            {% endif %}
        </div>
        
        <button type="submit" class="btn btn-primary mt-4">Save Changes</button>
    </form>
</section>
{% endblock %}

<script>
document.getElementById('bio').addEventListener('input', function() {
    document.getElementById('charCount').textContent = 
        this.value.length + '/500';
});
</script>